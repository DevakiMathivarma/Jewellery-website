{% extends "core/base.html" %}
{% load static %}
{% load socialaccount %}

{% block extra_css %}
<style>
  /* reuse same rules as login for consistency */
  .auth-wrap{ max-width: 980px; margin: 30px auto 60px; }
  .auth-grid{ display:grid; grid-template-columns: 360px 1fr; gap: 38px; align-items:start; }
  .auth-hero{ width:360px; height:300px; border-radius:10px; overflow:hidden; box-shadow:0 8px 24px rgba(0,0,0,.08); animation:fadeIn .5s both; }
  .auth-hero img{ width:100%; height:100%; object-fit:cover; }
  .auth-card{ animation: slideUp .55s ease both; }
  .auth-title{ font:700 42px/1.05 "Poppins", system-ui, sans-serif; color:#4cc14b; margin:0 0 8px; }
  .auth-sub{ color:#666; font:500 13px/1.4 "Inter", system-ui, sans-serif; margin-bottom:12px; }
  .auth-sub a{ color:#4cc14b; text-decoration:none; } .auth-sub a:hover{ text-decoration:underline; }

  .row2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .form-control{ height:44px; border:1px solid #e7e7e7; border-radius:8px; padding:10px 14px; font:500 14px/1.2 "Inter"; transition: box-shadow .2s, border-color .2s; }
  .form-control:focus{ border-color:#8be08a; box-shadow:0 0 0 3px rgba(76,193,75,.18); }
  .pass-wrap{ position:relative; }
  .toggle-eye{ position:absolute; right:10px; top:50%; transform:translateY(-50%); background:transparent; border:none; color:#9a9a9a; font-size:18px; }

  .terms{ font:500 13px/1.2 "Inter"; color:#444; margin:6px 0 12px; }
  .btn-green{ display:inline-block; width:100%; height:44px; border-radius:8px; border:none; cursor:pointer; background:#58cd54; color:#fff; font:600 14px/44px "Inter"; box-shadow:0 6px 16px rgba(88,205,84,.35); transition: transform .15s, box-shadow .15s, background .2s; margin:8px 0 16px; }
  .btn-green:hover{ transform:translateY(-1px); background:#49bd45; }

  .hr-lite{ border:none; border-top:1px solid #eee; margin:18px 0; }
  .or{ font:600 12px/1 "Inter"; color:#7c7c7c; text-align:center; margin:-8px 0 10px; }
  .btn-social{ height:40px; border:1px solid #e7e7e7; border-radius:8px; background:#fff; color:#333; display:flex; align-items:center; gap:8px; justify-content:center; font:600 13px/1 "Inter"; transition:transform .12s, box-shadow .2s; }
  .btn-social:hover{ transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.06); }
  .btn-facebook{ margin-left:10px; }

  .msg{ padding:10px 12px; border-radius:8px; font:600 13px/1.3 "Inter"; margin:10px 0; }
  .msg.error{ background:#ffe8e8; color:#a40000; border:1px solid #ffc9c9; }
  .msg.success{ background:#eaffea; color:#056b05; border:1px solid #b9efba; }

  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
  @keyframes slideUp{ from{opacity:.0; transform:translateY(10px)} to{opacity:1; transform:none} }
  @media (max-width: 820px){ .auth-grid{ grid-template-columns:1fr; } .auth-hero{ width:100%; height:260px; } }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrap">
  <div class="auth-grid">

    <figure class="auth-hero">
      <img src="{% static 'core/images/jewel-hero.jpg' %}" alt="Jewellery">
    </figure>

    <section class="auth-card">
      <h1 class="auth-title">Sign up</h1>
      <p class="auth-sub">Already have an account? <a href="{% url 'login' %}">log in</a></p>

      {% for m in messages %}
        <div class="msg {% if m.tags %}{{ m.tags }}{% endif %}">{{ m }}</div>
      {% endfor %}

      <form id="signupForm" method="post" novalidate>
        {% csrf_token %}

        <div class="row2">
          <input class="form-control" name="first_name" placeholder="First name" required>
          <input class="form-control" name="last_name" placeholder="Last name" required>
        </div>

        <div class="mt-2">
          <input class="form-control" name="email" placeholder="Email" required>
        </div>

        <div class="mt-2">
          <input class="form-control" name="username" placeholder="User Name" required>
        </div>

        <div class="mt-2 pass-wrap">
          <input class="form-control" id="signupPass" type="password" name="password" placeholder="Enter Your Password" required>
          <button type="button" class="toggle-eye" data-target="#signupPass"><i class="bi bi-eye-slash"></i></button>
        </div>

        <label class="terms"><input type="checkbox" name="terms" required> I agreed to the <a href="#" target="_blank">terms &amp; conditions</a></label>

        <button class="btn-green" type="submit">Create account</button>
      </form>

      <hr class="hr-lite">
      <div class="or">OR Register With</div>

      <div class="d-flex">
        <a class="btn-social flex-fill" href="{% provider_login_url 'google' %}">
          <img width="18" height="18" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="">
          Google
        </a>
       
      </div>
    </section>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // client-side strict validation (names letters only, email, password)
  (function(){
    const form = document.getElementById('signupForm');
    if(!form) return;

    const nameRe = /^[A-Za-z ]+$/;
    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
    const passRe = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;

    form.addEventListener('submit', function(e){
      const fn = form.first_name.value.trim();
      const ln = form.last_name.value.trim();
      const em = form.email.value.trim();
      const un = form.username.value.trim();
      const pw = form.password.value;

      let err = [];
      if(!nameRe.test(fn) || !nameRe.test(ln)) err.push('Name must contain letters and spaces only.');
      if(!emailRe.test(em)) err.push('Please enter a valid email.');
      if(!passRe.test(pw)) err.push('Password must be 6+ chars with at least one letter and one number.');
      if(un.length < 3) err.push('Username must be at least 3 characters.');

      if(err.length){
        e.preventDefault();
        alert('Please fix:\n• ' + err.join('\n• '));
      }
    });
  })();

  // toggle password buttons
  document.querySelectorAll(".toggle-eye").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const input = document.querySelector(btn.dataset.target);
      const icon = btn.querySelector("i");
      if(input.type === "password"){ input.type = "text"; icon.className="bi bi-eye"; }
      else{ input.type="password"; icon.className="bi bi-eye-slash"; }
    });
  });
</script>
{% endblock %}
