{% extends "core/base.html" %}
{% load static %}

{% block title %}Products | Cherii{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'core/css/product_detail.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />
{% endblock %}

{% block content %}
{% if banner %}
<section class="category-banner" style="background-image: url('{{ banner.image.url }}');">
  <div class="banner-overlay">
    <h1 class="banner-title">{{ banner.title }}</h1>
  </div>
</section>
{% endif %}

<div class="breadcrumb">
  <a href="{% url 'home' %}">Home</a> <span>›</span>
  <a href="{% url 'rental_page' %}">Collections</a> <span>›</span>
  <span>{{ category.name }}</span>
</div>

<div class="product-grid">
  {% for product in products %}
  <div class="product-card">
    <!-- Wishlist -->
    <!-- Inside product card -->
    <a href="{% url 'add_to_wishlist' product.id %}" class="wishlist">
      <i class="fa-regular fa-heart"></i>
    </a>


    <!-- Product Image -->
    <a href="{% url 'product_detail' product.id %}">
      {% if product.image and product.image.url %}
      <img src="{{ product.image.url }}" alt="{{ product.name }}">
      {% else %}
      <img src="{% static product.image %}" alt="{{ product.name }}">
      {% endif %}
    </a>

    <!-- Name & Rating -->
    <div class="product-header">
      <h3>{{ product.name }}</h3>
      <span class="rating"><i class="fa fa-star"></i> {{ product.rating }}</span>
    </div>

    <!-- Short Description -->
    <p class="short-desc">{{ product.short_description|default:"Elegant jewelry piece" }}</p>

    <!-- Price & Rent Now -->
    <div class="product-footer">
      <span class="price">₹{{ product.price_per_day }}/day</span>
      {% if user.is_authenticated %}
      <a href="{% url 'add_to_cart' product.id %}" onclick=" alert('✅ {{ product.name }} rented successfully!');"
        class="btn-rent">Rent Now</a>
      {% else %}
      <a href="{% url 'login' %}" onclick="alert('⚠️ Please login to rent this product');" class="btn-rent">Rent Now</a>
      {% endif %}

    </div>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination">
  {% if products.has_previous %}
  <a href="?page={{ products.previous_page_number }}">« Prev</a>
  {% endif %}

  <span>Page {{ products.number }} of {{ products.paginator.num_pages }}</span>

  {% if products.has_next %}
  <a href="?page={{ products.next_page_number }}">Next »</a>
  {% endif %}
</div>
{% endblock %}


<script>


  // Wishlist toggle
  document.querySelectorAll('.wishlist').forEach(btn => {
    btn.addEventListener('click', () => {
      btn.classList.toggle('active');
      btn.querySelector('i').classList.toggle('fa-regular');
      btn.querySelector('i').classList.toggle('fa-solid');
    });
  });

function flyToCart(productId) {
  const productImg = document.getElementById("product-" + productId);
  const cartIcon = document.getElementById("cartIcon");

  if (!productImg || !cartIcon) return;

  // Clone product image
  const imgClone = productImg.cloneNode(true);
  const rect = productImg.getBoundingClientRect();
  imgClone.style.position = "fixed";
  imgClone.style.left = rect.left + "px";
  imgClone.style.top = rect.top + "px";
  imgClone.style.width = rect.width + "px";
  imgClone.style.height = rect.height + "px";
  imgClone.style.opacity = "0.8";
  imgClone.style.zIndex = "9999";
  imgClone.style.transition = "all 1s cubic-bezier(.4,-0.3,.6,1.5)";

  document.body.appendChild(imgClone);

  // Animate to cart
  const cartRect = cartIcon.getBoundingClientRect();
  setTimeout(() => {
    imgClone.style.left = cartRect.left + "px";
    imgClone.style.top = cartRect.top + "px";
    imgClone.style.width = "40px";
    imgClone.style.height = "40px";
    imgClone.style.opacity = "0.2";
  }, 50);

  // Remove after animation
  setTimeout(() => { imgClone.remove(); }, 1000);
}
</script>

